/*! LCD game JavaScript library -- by BdR 2018 */
(()=>{var R='<div class="container">  <canvas id="mycanvas" class="gamecvs"></canvas>  <a class="mybutton btnmenu" onclick="LCDGame.displayInfobox();">help</a>  <a class="mybutton btnmenu" onclick="LCDGame.displayScorebox();">highscores</a>  <div class="infobox" id="infobox">    <div id="infocontent">      instructions    </div>    <a class="mybutton btnpop" onclick="LCDGame.hideInfobox();">Ok</a>  </div></div>';function E(){_(),document.getElementById("infobox").style.display="inherit"}function I(){document.getElementById("infobox").style.display="none"}var C='<div class="infobox" id="scorebox">  <div id="scoreheader">  </div>  <div id="scorecontent">    One moment...  </div>  <a class="mybutton btnnext" id="btnprev" data-direction="-1">&lt;&lt;</a>  <a class="mybutton btnnext" id="btnnext" data-direction="+1">&gt;&gt;</a>  <a class="mybutton btnpop" onclick="LCDGame.hideScorebox();">Ok</a></div>',G="http://bdrgames.nl/lcdgames/testphp/";function M(){I(),document.getElementById("scorebox").style.display="inherit"}function _(){document.getElementById("scorebox").style.display="none"}var w=10,H=function(t,e,s){this.lcdgame=t,this.gametitle=e,this.gametypes=s,this.offset=0,this._scores_local=[],this._scores_global=[],this._scoretype=0};H.prototype={init:function(t){var e=document.getElementById("btnprev"),s=document.getElementById("btnnext");e.addEventListener("click",this.onPrevNextButton.bind(this)),s.addEventListener("click",this.onPrevNextButton.bind(this)),this.buildHeaderHTML(),this.loadLocal(t),this.loadGlobal()},getGametype:function(){var t="";return this.gametypes&&(t=this.gametypes[this._scoretype-1]),t},loadLocal:function(t){this._scores_local=[],this._scoretype=t;var e="lcdgame_local_"+this.gametitle+"_hs"+t,s=window.localStorage.getItem(e);try{this._scores_local=JSON.parse(s)}catch(a){this._scores_local=[]}Object.prototype.toString.call(this._scores_local)!=="[object Array]"&&(this._scores_local=[])},indexLocal:function(t,e){e!=this._scoretype&&this.loadLocal(e);for(var s=-1,a=this._scores_local.length-1;a>=0&&t>this._scores_local[a].score;a--)s=a;return s},saveLocal:function(t,e,s,a){var i={player:t,score:e,level:s},o=this.indexLocal(e,a);o<0?this._scores_local.push(i):this._scores_local.splice(o,0,i);var n="lcdgame_local_"+this.gametitle+"_hs"+a;window.localStorage.setItem(n,JSON.stringify(this._scores_local)),window.localStorage.setItem("lcdgame_highscore_name",t)},saveGlobal:function(t,e,s,a,i,o){let{platform:n}=window,r;if(n)r=(n.product?"&device="+n.product:"")+(n.os?"&os="+n.os:"")+(n.name?"&browser="+n.name:"");else{var c=this.guessOsBrowser();r="&device="+c.device+"&os="+c.os+"&browser="+c.browser}var l=navigator.language,g=this.getClientGUID();this._scoretype=a,t=t.replace(/&/g,"%26");var v=G+"newhs.php",p="gamename="+this.gametitle+"&gametype="+a+"&player="+t+"&score="+e+"&level="+s+"&playtime="+i+"&buttonpress="+o+r+"&language="+l+"&lcdversion="+L+"&clientguid="+g,h=new XMLHttpRequest;h.open("POST",v,!0),h.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),h.onreadystatechange=function(y){if(h.status>=200&&h.status<400){if(h.readyState==4&&h.status==200){console.log(`SUCCESS!!
request.status=`+h.status+`
request.response=`+h.response);var u=JSON.parse(h.response);if(u.result=="OK"){console.log("Highscore sent succesfully");var S=u.rank?isNaN(u.rank)?1:u.rank:1;this.offset=w*Math.floor((S-1)/w),this.loadGlobal(),M()}else console.log("Highscore sent failed")}}else console.log("Highscore sent failed with error "+h.status+": "+h.statusText)}.bind(this),h.send(p)},getHighscore:function(t){var e=0;return this.lcdgame.highscores._scores_global[0]&&(e=this.lcdgame.highscores._scores_global[0].score),e},checkScore:function(){var t=new Date,e=this.lcdgame.score,s=this.lcdgame.level,a=this.lcdgame.gametype,i=Math.floor((t-this.lcdgame.playtimestart)/1e3),o=this.lcdgame.buttonpress;if(e>0){var n=window.localStorage.getItem("lcdgame_highscore_name")||"",r=prompt("New highscore, enter your name and press enter to submit or press cancel.",n);r!=null&&(r=r.trim(),r!=""&&(this.saveLocal(r,e,s,a),this.saveGlobal(r,e,s,a,i,o)))}},loadGlobal:function(){var t=G+"geths.php?gamename="+this.gametitle+"&gametype="+this._scoretype+"&offset="+this.offset,e=new XMLHttpRequest;e.open("GET",t,!0),e.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),e.onreadystatechange=function(){e.readyState==4&&e.status==200&&this.afterLoadGlobal(e.responseText)}.bind(this),e.send(null)},afterLoadGlobal:function(t){try{this._scores_global=JSON.parse(t)}catch(a){this._scores_global=[]}Object.prototype.toString.call(this._scores_global)!=="[object Array]"&&(this._scores_global=[]);for(var e=0;e<this._scores_global.length;e++){this._scores_global[e].local=!1;for(var s=0;s<this._scores_local.length;s++)this._scores_global[e].player==this._scores_local[s].player&&this._scores_global[e].score==this._scores_local[s].score&&(this._scores_global[e].local=!0)}this.refreshHTML()},onFilterButton:function(t){if(t.currentTarget.dataset){var e=parseInt(t.currentTarget.dataset.gametype);this.gametype!=e&&(this.offset=0,this.loadLocal(e),this.loadGlobal())}},onPrevNextButton:function(t){if(t.currentTarget.dataset){var e=parseInt(t.currentTarget.dataset.direction),s=this.offset+(e>0?w:-1*w);s<0&&(s=0),e>0&&this._scores_global.length<w&&(s=this.offset),this.offset!=s&&(this.offset=s,this.loadGlobal())}},buildHeaderHTML:function(){var t='<h1 id="scoretitle">'+this.gametitle+"</h1>";for(let s=this.gametypes.length-1;s>=0;s--)t=t+'<a class="filter" data-gametype="'+(s+1)+'" id="filtertype'+s+'">'+this.gametypes[s]+"</a>";document.getElementById("scoreheader").innerHTML=t;for(let s=0;s<this.gametypes.length;s++){var e=document.getElementById("filtertype"+s);e.addEventListener("click",this.onFilterButton.bind(this))}},refreshHTML:function(){for(var t="",e=0;e<w;e++){var s=this._scores_global[e];if(typeof s=="undefined"){var a=this.offset+(e+1);s={rank:a,player:".....",score:0,level:1,local:!1}}var i=s.local?' style="color:#f00"':"";t=t+"      <tr"+i+"><td>"+s.rank+".</td><td>"+s.player+"</td><td>"+s.score+"</td></tr>"}var o="<table>      <tr><td>Rk.</td><td>Name</td><td>Score</td></tr>"+t+"    </table>";this.lcdgame.scorecontent.innerHTML=o,o=this.gametitle+" ("+this.getGametype()+")",document.getElementById("scoretitle").innerHTML=o},uuidv4:function(){for(var t="",e,s=0;s<32;s++)e=Math.random()*16|0,(s==8||s==12||s==16||s==20)&&(t+="-"),t+=(s==12?4:s==16?e&3|8:e).toString(16);return t},getClientGUID:function(){var t=window.localStorage.getItem("lcdgame_client_guid");return t||(t=this.uuidv4(),window.localStorage.setItem("lcdgame_client_guid",t)),t},guessOsBrowser:function(){var t="",e="",s="",a=navigator.userAgent||navigator.vendor||window.opera;if(/BlackBerry|BB10|PlayBook|Passport/i.test(a)?t="BlackBerry":/GT-I9\d{3}|SM-G9\d{2}/.test(a)?t="Galaxy S-series":/SM-A\d{3}/.test(a)?t="Galaxy A-series":/SM-J\d{3}/.test(a)?t="Galaxy J-series":/SM-T\d{3}/.test(a)?t="Galaxy Tab":/SM-N\d{3}/.test(a)?t="Galaxy Note":/SAMSUNG/.test(a)?t="Samsung":/huawei/i.test(a)?t="Huawei":/kindle/.test(a)?t="Kindle":/xbox one/i.test(a)?t="Xbox One":/xbox/i.test(a)?t="Xbox 360":/playstation /i.test(a)?t=/playstation [^;) ]*/i.exec(a)||"Playstation":/nintendo wii/i.test(a)?t="Wii U":/IEMobile|Windows Phone/i.test(a)?t="Windows Phone":/iPad|iPhone|iPod/.test(a)&&!window.MSStream?/iPad/.test(a)?t="iPad":/iPod/.test(a)?t="iPod":t="iPhone":/mac os|macintosh/i.test(a)&&(t="Macintosh"),/tizen /i.test(a))e=/tizen [^;)]*/i.exec(a)[0]||"Tizen";else if(/windows phone/i.test(a))e="Windows Phone";else if(/android /i.test(a))e=/android [^;)]*/i.exec(a)[0]||"Android";else if(/iPad|iPhone|iPod/.test(a)&&!window.MSStream){let i=/(iphone os |cpu os )[^;) ]*/i.exec(a);e=i[0]||"",e=e.replace(/cpu|iphone|os/ig,"").trim(),e="iOS "+e.replace(/_/g,".")}else if(/mac os/i.test(a))e="Mac OS";else if(/windows /i.test(a)){let i=/windows [^;)]*/i.exec(a)[0];e=i||"Windows",/10/.test(i)&&(e="Windows 10"),/6.3/.test(i)&&(e="Windows 8.1"),/6.2/.test(i)&&(e="Windows 8"),/6.1/.test(i)&&(e="Windows 7"),/6.0/.test(i)&&(e="Windows Vista"),/5.1|5.2/.test(i)&&(e="Windows XP"),/5.0/.test(i)&&(e="Windows 2000")}else e=navigator.platform;return!!window.opr&&!!window.opr.addons||!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0?s="Opera 8.0+":typeof InstallTrigger!="undefined"?s="Firefox 1.0+":/edge/i.test(a)?s="Edge":/chrome/i.test(a)&&/google/i.test(navigator.vendor)?s="Chrome":/safari/i.test(a)&&/apple computer/i.test(navigator.vendor)?s="Safari":/iemobile/i.test(a)?s=/iemobile[^;) ]*/i.exec(a)[0]||"IEMobile":/MSIE /.test(a)?s=/MSIE [^;) ]*/.exec(a)[0]||"MSIE":/rv:11\./.test(a)?s="MSIE 11":document.documentMode&&(s="MSIE 6-11"),t=t.replace(/&|\?|\//g," ").trim(),e=e.replace(/&|\?|\//g," ").trim(),s=s.replace(/&|\?|\//g," ").trim(),{device:t,os:e,browser:s}}};var D=H,A=function(t){this.lcdgame=t,this.raftime=null};A.prototype={start:function(){for(var t=["ms","moz","webkit","o"],e=0;e<t.length&&!window.requestAnimationFrame;e++)window.requestAnimationFrame=window[t[e]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[e]+"CancelAnimationFrame"];var s=this;window.requestAnimationFrame?(this.animationLoop=function(a){return s.updateAnimFrame(a)},window.requestAnimationFrame(this.animationLoop)):(this.animationLoop=function(){return s.updateSetTimeout()},window.setTimeout(this.animationLoop,0))},updateAnimFrame:function(t){this.lcdgame.state.checkSwitch(),this.raftime=Math.floor(t),this.lcdgame.updateloop(this.raftime),window.requestAnimationFrame(this.animationLoop)},updateSetTimeout:function(){this.lcdgame.state.checkSwitch(),this.raftime=Date.now(),this.lcdgame.updateloop(this.raftime);var t=Math.floor(1e3/60);window.setTimeout(this.animationLoop,t)}};var P=A,F=function(t){this.lcdgame=t,this._currentState="",this._pendingState="",this.states={}};F.prototype={add:function(t,e){return this.states[t]=new e(this.lcdgame),this._pendingState=t,e},start:function(t){this.lcdgame.cleartimers(),this._currentState&&(this.states[this._currentState].destroy,this._currentState=""),this._pendingState=t},currentState:function(){if(this._currentState)return this.states[this._currentState]},checkSwitch:function(){this._currentState!=this._pendingState&&(this._currentState=this._pendingState,this.states[this._currentState].init())}};var W=F,z=function(t,e,s,a){this.context=t,this.callback=e,this.interval=s||1e3,this.waitfirst=a,this.counter=0,this.max=null,this.enabled=!1,this.timerId=0,this.lasttime=0};z.prototype={update:function(t){var e=this.callback.name,s=t-this.lasttime;s>=this.interval&&(this.lasttime=this.lasttime+this.interval,this.doTimerEvent())},doTimerEvent:function(){this.counter++,this.callback.call(this.context,this),typeof this.max!="undefined"&&(this.counter>=this.max&&(this.enabled=!1))},start:function(t,e){typeof e!="undefined"&&(this.waitfirst=e),this.enabled=!0,this.counter=0,this.max=t,this.lasttime=this.context.lcdgame.raf.raftime||0,this.waitfirst==!1&&(this.lasttime-=this.interval)},pause:function(){this.enabled=!1},unpause:function(){this.lasttime=this.context.lcdgame.raf.raftime||0,this.waitfirst==!1&&(this.lasttime-=this.interval),this.enabled=!0}};var U=z,X=function(t,e){this.gamedata=[],this.imageBackground=null,this.imageShapes=null,this.score=0,this.gametype=0,this.level=0,this.buttonpress=0,this.playtimestart=null,this.soundmute=!1,this.countimages=0,this.scaleFactor=1,this.imageBackground=new Image,this.imageShapes=new Image,this.imageBackground.addEventListener?(this.imageBackground.addEventListener("load",this.onImageLoaded.bind(this)),this.imageBackground.addEventListener("error",this.onImageError.bind(this)),this.imageShapes.addEventListener("load",this.onImageLoaded.bind(this)),this.imageShapes.addEventListener("error",this.onImageError.bind(this))):(this.imageBackground.attachEvent("load",this.onImageLoaded.bind(this)),this.imageBackground.attachEvent("error",this.onImageError.bind(this)),this.imageShapes.attachEvent("load",this.onImageLoaded.bind(this)),this.imageShapes.attachEvent("error",this.onImageError.bind(this)));var s=R+C;return document.write(s),this.canvas=document.getElementById("mycanvas"),this.infobox=document.getElementById("infobox"),this.scorebox=document.getElementById("scorebox"),this.infocontent=document.getElementById("infocontent"),this.scorecontent=document.getElementById("scorecontent"),this.context2d=this.canvas.getContext("2d"),this.state=new W(this),this.raf=new P(this),this.timers=[],this.loadConfig(t),e=e||"metadata/gameinfo.json",this.loadMetadata(e),this._touchdevice=!1,this};X.prototype={onImageLoaded:function(){this.countimages++,this.countimages>=2&&this.initGame()},onImageError:function(){console.log("** ERROR ** lcdgame.js - onImageError.")},loadConfig:function(t){var e=function(){s.readyState===XMLHttpRequest.DONE&&(s.status===200||s.status===0?this.onConfigLoad(JSON.parse(s.responseText)):this.onConfigError(s))},s=new XMLHttpRequest;s.onreadystatechange=e.bind(this),s.open("GET",t,!0),s.send()},onConfigLoad:function(t){this.gamedata=t,this.imageBackground.src=t.imgback,this.imageShapes.src=t.imgshapes;for(var e=0;e<this.gamedata.frames.length;e++)this.gamedata.frames[e].value=!1,this.gamedata.frames[e].valprev=!1,this.gamedata.frames[e].type="shape";for(var s=0;s<this.gamedata.sequences.length;s++){this.gamedata.sequences[s].ids=[];for(var a=0;a<this.gamedata.sequences[s].frames.length;a++){var i=this.gamedata.sequences[s].frames[a],o=this.shapeIndexByName(i);this.gamedata.sequences[s].ids.push(o)}}for(var n=0;n<this.gamedata.digits.length;n++){this.gamedata.digits[n].ids=[],this.gamedata.digits[n].locids=[];for(let d=0;d<this.gamedata.digits[n].frames.length;d++){let x=this.gamedata.digits[n].frames[d],b=this.shapeIndexByName(x);this.gamedata.digits[n].ids.push(b),b!=-1&&(this.gamedata.frames[b].type="digit")}for(var r=0;r<this.gamedata.digits[n].locations.length;r++){let d=this.gamedata.digits[n].locations[r],x=this.shapeIndexByName(d);this.gamedata.digits[n].locids.push(x)}var c=this.gamedata.digits[n].max||"";if(c==""){for(var l=0;l<this.gamedata.digits[n].locids.length;l++)c+="8";this.gamedata.digits[n].max=c}}for(var g=0;g<this.gamedata.buttons.length;g++){this.gamedata.buttons[g].ids=[];var v=1e4,p=1e4,h=0,y=0;for(let d=0;d<this.gamedata.buttons[g].frames.length;d++){let x=this.gamedata.buttons[g].frames[d],b=this.shapeIndexByName(x);this.gamedata.buttons[g].ids.push(b),this.gamedata.frames[b].type="button";var u=this.gamedata.frames[b].spriteSourceSize;u.x<v&&(v=u.x),u.y<p&&(p=u.y),u.x+u.w>h&&(h=u.x+u.w),u.y+u.h>y&&(y=u.y+u.h)}var S=h-v,q=y-p;v=v-S,p=p-q,h=h+S,y=y+q;var V=(v+h)/2,K=(p+y)/2;this.gamedata.buttons[g].area={x1:v,y1:p,x2:h,y2:y,xc:V,yc:K};var B=this.gamedata.buttons[g].name;typeof this.gamedata.buttons[g].defaultkeys!="undefined"&&(B=this.gamedata.buttons[g].defaultkeys),this.gamedata.buttons[g].keycodes=this.determineKeyCodes(B)}for(var m=0;m<this.gamedata.buttons.length-1;m++)for(var f=m+1;f<this.gamedata.buttons.length;f++)if(this.gamedata.buttons[m].area.x1<this.gamedata.buttons[f].area.x2&&this.gamedata.buttons[m].area.x2>this.gamedata.buttons[f].area.x1&&this.gamedata.buttons[m].area.y1<this.gamedata.buttons[f].area.y2&&this.gamedata.buttons[m].area.y2>this.gamedata.buttons[f].area.y1){var k=this.gamedata.buttons[m].area.xc,T=this.gamedata.buttons[m].area.yc,N=this.gamedata.buttons[f].area.xc,O=this.gamedata.buttons[f].area.yc;if(Math.abs(k-N)>Math.abs(T-O))if(k>N){let d=(this.gamedata.buttons[m].area.x1-this.gamedata.buttons[f].area.x2)/2;this.gamedata.buttons[m].area.x1-=d,this.gamedata.buttons[f].area.x2+=d}else{let d=(this.gamedata.buttons[m].area.x2-this.gamedata.buttons[f].area.x1)/2;this.gamedata.buttons[m].area.x2-=d,this.gamedata.buttons[f].area.x1+=d}else if(T>O){let d=(this.gamedata.buttons[m].area.y1-this.gamedata.buttons[f].area.y2)/2;this.gamedata.buttons[m].area.y1-=d,this.gamedata.buttons[f].area.y2+=d}else{let d=(this.gamedata.buttons[m].area.y2-this.gamedata.buttons[f].area.y1)/2;this.gamedata.buttons[m].area.y2-=d,this.gamedata.buttons[f].area.y1+=d}}},onConfigError:function(t){console.log("** ERROR ** lcdgame.js - onConfigError: error loading json file"),console.error(t)},loadMetadata:function(t){var e=function(){s.readyState===XMLHttpRequest.DONE&&(s.status===200||s.status===0?this.onMetadataLoad(JSON.parse(s.responseText)):this.onMetadataError(s))},s=new XMLHttpRequest;s.onreadystatechange=e.bind(this),s.open("GET",t,!0),s.send()},tinyMarkDown:function(t){return t=t.replace(/\n/gi,"<br/>"),t=t.replace(/\*.*?\*/g,function(e){return"<b>"+e.slice(1,-1)+"</b>"}),t=t.replace(/_.*?_/g,function(e){return"<i>"+e.slice(1,-1)+"</i>"}),t=t.replace(/\[(?:(?!\[).)*?\](?!\()/g,function(e){return"<btn>"+e.slice(1,-1)+"</btn>"}),t=t.replace(/(\[(?:(?!\[).)*?\])(\((?:(?!\().)*?\))/g,function(e,s,a,i){var o=a.slice(1,-1);o.indexOf("http")!=0&&(o="http://"+o);var n=s.slice(1,-1);return'<a href="'+o+'">'+n+"</a>"}),t},onMetadataLoad:function(t){this.metadata=t;var e=this.tinyMarkDown(t.gameinfo.instructions.en);this.infocontent.innerHTML="<h1>How to play</h1><br/>"+e;var s=t.gameinfo.device.title,a=t.gameinfo.gametypes;this.gametype=typeof a=="undefined"?0:1,this.highscores=new D(this,s,a),this.highscores.init(this.gametype)},onMetadataError:function(t){console.log("** ERROR ** lcdgame.js - onMetadataError: error loading json file"),console.error(t)},resizeCanvas:function(){var t=window.innerWidth/window.innerHeight,e=this.canvas.width/this.canvas.height,s=this.canvas.width,a=this.canvas.height;if(e>t){s=window.innerWidth,this.scaleFactor=s/this.canvas.width,a=this.canvas.height*this.scaleFactor;var i=(window.innerHeight-a)/2;this.canvas.style["margin-top"]=i+"px",this.canvas.style["margin-bottom"]=-i+"px",this.canvas.style["margin-left"]="0px"}else{a=window.innerHeight,this.scaleFactor=a/this.canvas.height,s=this.canvas.width*this.scaleFactor;var o=(window.innerWidth-s)/2;this.canvas.style["margin-left"]=o+"px",this.canvas.style["margin-right"]=-o+"px",this.canvas.style["margin-top"]="0px"}this.canvas.style.width=s+"px",this.canvas.style.height=a+"px",this.canvas.style.display="block",this.canvas.style["touch-action"]="none",this.canvas.style["user-select"]="none",this.canvas.style["-webkit-tap-highlight-color"]="rgba(0, 0, 0, 0)",this.resizeInfobox(this.infobox),this.resizeInfobox(this.scorebox)},resizeInfobox:function(t){t.style.display="inherit";var e=t.offsetWidth,s=t.offsetHeight,a=t.getBoundingClientRect();a&&(e=a.width,s=a.height);var i=(window.innerWidth-e)/2,o=(window.innerHeight-s)/2;t.style["margin-left"]=i+"px",t.style["margin-right"]=-i+"px",t.style["margin-top"]=o+"px",t.style["margin-bottom"]=-o+"px",t.style.display="none"},initGame:function(){document.body.scrollTop=0,document.body.style.overflow="hidden",this.canvas.width=this.imageBackground.width,this.canvas.height=this.imageBackground.height,this.context2d.drawImage(this.imageBackground,0,0);for(var t=0;t<this.gamedata.sounds.length;t++){var e=this.gamedata.sounds[t].filename;this.gamedata.sounds[t].audio=new Audio(e),this.gamedata.sounds[t].audio.load()}("ontouchstart"in document.documentElement||window.navigator.maxTouchPoints&&window.navigator.maxTouchPoints>=1)&&(this._touchdevice=!0),document.addEventListener?(this.canvas.addEventListener("mousedown",this.onmousedown.bind(this),!1),this.canvas.addEventListener("mouseup",this.onmouseup.bind(this),!1),document.addEventListener("keydown",this.onkeydown.bind(this),!1),document.addEventListener("keyup",this.onkeyup.bind(this),!1),this._touchdevice&&(this.canvas.addEventListener("touchstart",this.ontouchstart.bind(this),!1),this.canvas.addEventListener("touchend",this.ontouchend.bind(this),!1))):(this.canvas.attachEvent("mousedown",this.onmousedown.bind(this)),this.canvas.attachEvent("mouseup",this.onmouseup.bind(this)),document.attachEvent("keydown",this.onkeydown.bind(this)),document.attachEvent("keyup",this.onkeyup.bind(this))),window.addEventListener("resize",this.resizeCanvas.bind(this),!1),this.resizeCanvas(),E(),this.raf.start(),console.log("lcdgame.js v"+L+" :: start")},addtimer:function(t,e,s,a){typeof a=="undefined"&&(a=!0);var i=new U(t,e,s,a);return this.timers.push(i),i},cleartimers:function(){for(var t=0;t<this.timers.length;t++)this.timers[t].pause(),this.timers[t]=null;this.timers=[]},updateloop:function(t){for(var e=0;e<this.timers.length;e++)this.timers[e].enabled&&this.timers[e].update(t);this._refresh&&(this.shapesRefresh(),this._refresh=!1)},gameReset:function(t){this.score=0,this.level=0,this.gametype=t,this.buttonpress=0,this.playtimestart=new Date},loadSoundEffects:function(){console.log("loadSoundEffects - TODO load sound effects")},setSoundMute:function(t){this.soundmute=t},soundIndexByName:function(t){for(var e=0,s=0;s<this.gamedata.sounds.length;s++)if(this.gamedata.sounds[s].name==t)return s;return-1},playSoundEffect:function(t){if(!this.soundmute){var e=this.soundIndexByName(t);e>=0&&(this.gamedata.sounds[e].audio.paused==!1&&(this.gamedata.sounds[e].audio.pause(),isNaN(this.gamedata.sounds[e].audio.duration)||(this.gamedata.sounds[e].audio.currentTime=0)),this.gamedata.sounds[e].audio.play())}},randomInteger:function(t,e){e=e-t+1;var s=Math.floor(Math.random()*e)+t;return s},shapeIndexByName:function(t){for(var e=0;e<this.gamedata.frames.length;e++)if(this.gamedata.frames[e].filename==t)return e;throw console.log("** ERROR ** shapeIndexByName('"+t+"') - filename not found."),"lcdgames.js - "+arguments.callee.caller.toString()+", no frame with filename '"+t+"'"},setShapeByName:function(t,e){if(this.gamedata.frames){for(var s=0;s<this.gamedata.frames.length;s++)if(this.gamedata.frames[s].filename==t)return this.gamedata.frames[s].value=e,this._refresh=!0,!0;throw"lcdgames.js - "+arguments.callee.caller.toString()+", no frame with filename '"+t+"'"}return!1},setShapeByIdx:function(t,e){return this.gamedata.frames[t].value=e,this._refresh=!0,!0},sequenceIndexByName:function(t){if(this.gamedata.sequences){for(var e=0;e<this.gamedata.sequences.length;e++)if(this.gamedata.sequences[e].name==t)return e;throw console.log("** ERROR ** sequenceIndexByName('"+t+"') - sequence name not found."),"lcdgames.js - "+arguments.callee.caller.toString()+", no sequence with name '"+t+"'"}return-1},sequenceResetAll:function(t,e){typeof e=="undefined"&&(e=!1);for(var s=this.sequenceIndexByName(t),a=0;a<this.gamedata.sequences[s].ids.length;a++){var i=this.gamedata.sequences[s].ids[a];this.gamedata.frames[i].value=e}this._refresh=!0},sequenceClear:function(t){this.sequenceResetAll(t)},sequenceShift:function(t,e){var s=this.sequenceIndexByName(t);typeof e=="undefined"&&(e=this.gamedata.sequences[s].ids.length);var a,i=!1;for(a=e-1;a>0;a--){let n=this.gamedata.sequences[s].ids[a-1],r=this.gamedata.sequences[s].ids[a];a==e-1&&(i=this.gamedata.frames[r].value),this.gamedata.frames[r].value=this.gamedata.frames[n].value}var o=this.gamedata.sequences[s].ids[0];return this.gamedata.frames[o].value=!1,this._refresh=!0,i},sequenceShiftReverse:function(t,e){var s=this.sequenceIndexByName(t);typeof e=="undefined"&&(e=0);var a;for(a=e;a<this.gamedata.sequences[s].ids.length-1;a++){let o=this.gamedata.sequences[s].ids[a],n=this.gamedata.sequences[s].ids[a+1];this.gamedata.frames[o].value=this.gamedata.frames[n].value}var i=this.gamedata.sequences[s].ids[a];this.gamedata.frames[i].value=!1,this._refresh=!0},sequenceSetFirst:function(t,e){var s=this.sequenceIndexByName(t),a=this.gamedata.sequences[s].ids[0];this.gamedata.frames[a].value=e,this._refresh=!0},sequenceSetPos:function(t,e,s){if(this.gamedata.sequences){var a=this.sequenceIndexByName(t);if(e==-1&&(e=this.gamedata.sequences[a].ids.length-1),e<this.gamedata.sequences[a].ids.length){var i=this.gamedata.sequences[a].ids[e];this.gamedata.frames[i].value=s,this._refresh=!0}}},shapeVisible:function(t){for(var e=0;e<this.gamedata.frames.length;e++)if(this.gamedata.frames[e].filename==t&&this.gamedata.frames[e].value==!0)return!0;return!1},sequenceShapeVisible:function(t,e){var s=this.sequenceIndexByName(t);if(typeof e=="undefined")for(var a=0;a<this.gamedata.sequences[s].ids.length;a++){let i=this.gamedata.sequences[s].ids[a];if(this.gamedata.frames[i].value==!0)return!0}else if(e==-1&&(e=this.gamedata.sequences[s].ids.length-1),e<this.gamedata.sequences[s].ids.length){let i=this.gamedata.sequences[s].ids[e];if(this.gamedata.frames[i].value==!0)return!0}return!1},sequenceAllVisible:function(t,e){for(var s=this.sequenceIndexByName(t),a=0;a<this.gamedata.sequences[s].ids.length;a++){var i=this.gamedata.sequences[s].ids[a];if(this.gamedata.frames[i].value!=e)return!1}return!0},shapesDisplayAll:function(t){if(this.gamedata.frames){for(let e=0;e<this.gamedata.frames.length;e++)(this.gamedata.frames[e].type=="shape"||this.gamedata.frames[e].type=="digitpos")&&(this.gamedata.frames[e].value=t);if(t==!0)for(let e=0;e<this.gamedata.digits.length;e++)this.digitsDisplay(this.gamedata.digits[e].name,this.gamedata.digits[e].max);this._refresh=!0}},digitsDisplay:function(t,e,s){if(!this.gamedata.digits)return;var a=-1;for(let l=0;l<this.gamedata.digits.length;l++)if(this.gamedata.digits[l].name==t){a=l;break}if(a==-1)throw console.log("** ERROR ** digitsDisplay('"+t+"') - digits not found."),"lcdgames.js - digitsDisplay, no digits with name '"+t+"'";var i=0,o=0;s==!0&&(o=this.gamedata.digits[a].locids.length-e.length,o<0&&(i=Math.abs(o),o=0));for(let l=0;l<this.gamedata.digits[a].locids.length;l++){var n=this.gamedata.digits[a].locids[l];if(l<o||i>=e.length)this.gamedata.frames[n].value=!1;else{var r=e.charCodeAt(i)-48;if(r>=0&&r<this.gamedata.digits[a].ids.length){var c=this.gamedata.digits[a].ids[r];this.gamedata.frames[n].frame.x=this.gamedata.frames[c].frame.x,this.gamedata.frames[n].frame.y=this.gamedata.frames[c].frame.y,this.gamedata.frames[n].value=!0}else this.gamedata.frames[n].value=!1;i=i+1}}this._refresh=!0},shapesRefresh:function(){if(this.gamedata.frames){this.context2d.drawImage(this.imageBackground,0,0);for(var t=0;t<this.gamedata.frames.length;t++)this.gamedata.frames[t].value==!0&&this.shapeDraw(t);this.drawDebugText()}this._refresh=!1},shapeDraw:function(t){this.context2d.drawImage(this.imageShapes,this.gamedata.frames[t].frame.x,this.gamedata.frames[t].frame.y,this.gamedata.frames[t].frame.w,this.gamedata.frames[t].frame.h,this.gamedata.frames[t].spriteSourceSize.x,this.gamedata.frames[t].spriteSourceSize.y,this.gamedata.frames[t].spriteSourceSize.w,this.gamedata.frames[t].spriteSourceSize.h)},debugText:function(t){this.debugtxt=t},drawDebugText:function(){if(this.debugtxt){this.context2d.font="bold 24px sans-serif";for(var t=50,e=50,s=15,a=this.debugtxt.split(`
`),i=0;i<a.length;i++)this.context2d.fillStyle="#000",this.context2d.fillText(a[i],t+2,e+2),this.context2d.fillStyle="#fff",this.context2d.fillText(a[i],t,e),e=e+s}},buttonAdd:function(t,e,s){typeof this.buttons=="undefined"&&(this.buttons=[]);var a=this.gamedata.buttons.length;this.gamedata.buttons[a]={},this.gamedata.buttons[a].name=t,this.gamedata.buttons[a].frames=e,this.gamedata.buttons[a].defaultkeys=s,this.gamedata.buttons[a].keycodes=this.determineKeyCodes(s)},determineKeyCodes:function(t){for(var e=[],s=0;s<t.length;s++){var a=0,i=t[s];i=i.toUpperCase(),i.indexOf("PGUP")>-1?a=33:i.indexOf("PGDN")>-1?a=34:i.indexOf("END")>-1?a=35:i.indexOf("HOME")>-1?a=36:i.indexOf("UP")>-1?a=38:i.indexOf("DOWN")>-1?a=40:i.indexOf("LEFT")>-1?a=37:i.indexOf("RIGHT")>-1?a=39:a=i.charCodeAt(0),e.push(a)}return e},ontouchstart:function(t){t.preventDefault();for(var e=0;e<event.changedTouches.length;e++)this.onmousedown(event.changedTouches[e])},ontouchend:function(t){t.preventDefault();for(var e=0;e<t.changedTouches.length;e++)this.onmouseup(t.changedTouches[e])},onmousedown:function(t){var e=t.offsetX||t.clientX-t.target.offsetLeft,s=t.offsetY||t.clientY-t.target.offsetTop;e=e/this.scaleFactor,s=s/this.scaleFactor;for(var a=0;a<this.gamedata.buttons.length;a++)if(e>this.gamedata.buttons[a].area.x1&&e<this.gamedata.buttons[a].area.x2&&s>this.gamedata.buttons[a].area.y1&&s<this.gamedata.buttons[a].area.y2){var i=0;let r,c;switch(this.gamedata.buttons[a].type){case"updown":c=(this.gamedata.buttons[a].area.y2-this.gamedata.buttons[a].area.y1)/2,i=s<this.gamedata.buttons[a].area.y1+c?0:1;break;case"leftright":r=(this.gamedata.buttons[a].area.x2-this.gamedata.buttons[a].area.x1)/2,i=e<this.gamedata.buttons[a].area.x1+r?0:1;break;case"dpad":r=(this.gamedata.buttons[a].area.x2-this.gamedata.buttons[a].area.x1)/2,c=(this.gamedata.buttons[a].area.y2-this.gamedata.buttons[a].area.y1)/2;var o=e-this.gamedata.buttons[a].area.x1-r,n=s-this.gamedata.buttons[a].area.y1-c;Math.abs(o)<Math.abs(n)?i=n<0?0:1:i=o<0?2:3;break}this.onButtonDown(a,i)}},onmouseup:function(t){var e=t.offsetX||t.clientX-t.target.offsetLeft,s=t.offsetY||t.clientY-t.target.offsetTop;e=e/this.scaleFactor,s=s/this.scaleFactor;for(var a=0;a<this.gamedata.buttons.length;a++)if(e>this.gamedata.buttons[a].area.x1&&e<this.gamedata.buttons[a].area.x2&&s>this.gamedata.buttons[a].area.y1&&s<this.gamedata.buttons[a].area.y2){var i=0;let l;switch(this.gamedata.buttons[a].type){case"updown":l=(this.gamedata.buttons[a].area.y2-this.gamedata.buttons[a].area.y1)/2,i=s<this.gamedata.buttons[a].area.y1+l?0:1;break;case"leftright":l=(this.gamedata.buttons[a].area.x2-this.gamedata.buttons[a].area.x1)/2,i=e<this.gamedata.buttons[a].area.x1+l?0:1;break;case"dpad":var o=(this.gamedata.buttons[a].area.x2-this.gamedata.buttons[a].area.x1)/2,n=(this.gamedata.buttons[a].area.y2-this.gamedata.buttons[a].area.y1)/2,r=e-this.gamedata.buttons[a].area.x1-o,c=s-this.gamedata.buttons[a].area.y1-n;Math.abs(r)<Math.abs(c)?i=c<0?0:1:i=r<0?2:3;break}this.onButtonUp(a,i)}},onkeydown:function(t){for(var e=t.keyCode,s=0;s<this.gamedata.buttons.length;s++)for(var a=0;a<this.gamedata.buttons[s].keycodes.length;a++)this.gamedata.buttons[s].keycodes[a]==e&&this.onButtonDown(s,a)},onkeyup:function(t){for(var e=t.keyCode,s=0;s<this.gamedata.buttons.length;s++)for(var a=0;a<this.gamedata.buttons[s].keycodes.length;a++)this.gamedata.buttons[s].keycodes[a]==e&&this.onButtonUp(s)},onButtonDown:function(t,e){var s=this.gamedata.buttons[t].name;e>=this.gamedata.buttons[t].ids.length&&(e=e%this.gamedata.buttons[t].ids.length),this.state.currentState().press(s,e),this.buttonpress++;var a=this.gamedata.buttons[t].ids[e];this.setShapeByIdx(a,!0)},onButtonUp:function(t,e){for(var s=0;s<this.gamedata.buttons[t].ids.length;s++){var a=this.gamedata.buttons[t].ids[s];this.setShapeByIdx(a,!1)}let i=this.state.currentState();if(i?.release){var o=this.gamedata.buttons[t].name;i.release(o,e)}},debugRectangle:function(t,e,s,a){var i="#f0f";this.context2d.beginPath(),this.context2d.lineWidth="1",this.context2d.strokeStyle=i,this.context2d.fillStyle=i,this.context2d.rect(t,e,s,a),this.context2d.stroke()},is_touch_device:function(){var t=document.createElement("div");return t.setAttribute("lcdgame.js - ongesturestart","return;"),typeof t.ongesturestart=="function"}};var j=X,L="0.3.4",Y=window.LCDGame||{loadsounds:null,countimages:0,scaleFactor:1,score:0,gametype:0,level:0,buttonpress:0,playtimestart:null,onImageLoaded:null,onImageError:null,canvas:null,context2d:null,debugtxt:null,displayScorebox:M,hideScorebox:_,displayInfobox:E,hideInfobox:I,Game:j},J=Y;window.LCDGame=J;})();
//# sourceMappingURL=lcdgame.min.js.map
